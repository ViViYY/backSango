{"version":3,"sources":["../../../../../assets/Script/util/assets/Script/util/socketController.js"],"names":["socketController","that","_socket","_event","_callbackIndex","_callbackMap","init","io","defines","serverUrl","on","data","console","log","JSON","stringify","msg","fire","callbackIndex","cb","err","notify","emit","request","login","registerAndLogin","onEnterGame"],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,IAAMA,mBAAmB,SAAnBA,gBAAmB,GAAY;AACjC,QAAIC,OAAO,EAAX;AACA,QAAIC,UAAU,IAAd;AACA,QAAIC,SAAS,6BAAc,EAAd,CAAb;AACA,QAAIC,iBAAiB,CAArB;AACA,QAAIC,eAAe,EAAnB;;AAEAJ,SAAKK,IAAL,GAAY,YAAY;AACpBJ,kBAAUK,GAAGC,QAAQC,SAAX,CAAV;AACAP,gBAAQQ,EAAR,CAAW,SAAX,EAAsB,UAAUC,IAAV,EAAgB;AAClCC,oBAAQC,GAAR,CAAY,mBAAmBF,KAAKA,IAApC;AACH,SAFD;AAGAT,gBAAQQ,EAAR,CAAW,QAAX,EAAqB,UAAUC,IAAV,EAAgB;AACjCC,oBAAQC,GAAR,CAAY,0BAA0BC,KAAKC,SAAL,CAAeJ,IAAf,CAAtC;AACA,gBAAIK,MAAML,KAAKK,GAAf;AACAb,mBAAOc,IAAP,CAAYD,GAAZ,EAAiBL,KAAKA,IAAtB;AACA,gBAAIO,gBAAgBP,KAAKO,aAAzB;AACA,gBAAGA,aAAH,EAAiB;AACb,oBAAIC,KAAKd,aAAaa,aAAb,CAAT;AACA,oBAAGC,EAAH,EAAM;AACH,wBAAGR,KAAKA,IAAL,CAAUS,GAAb,EAAiB;AACbD,2BAAGR,KAAKA,IAAL,CAAUS,GAAb;AACH,qBAFD,MAEO;AACHD,2BAAG,IAAH,EAASR,KAAKA,IAAd;AACH;AACH;AACJ;AACJ,SAfD;AAgBH,KArBD;AAsBA;AACA,QAAMU,SAAS,SAATA,MAAS,CAAUL,GAAV,EAAeL,IAAf,EAAqB;AAChCC,gBAAQC,GAAR,CAAY,6BAA6BG,GAA7B,GAAmC,qBAAnC,GAA2DZ,cAA3D,GAA4E,aAA5E,GAA4FU,KAAKC,SAAL,CAAeJ,IAAf,CAAxG;AACAT,gBAAQoB,IAAR,CAAa,QAAb,EAAuB,EAACN,KAAKA,GAAN,EAAWE,eAAed,cAA1B,EAA0CO,MAAMA,IAAhD,EAAvB;AACAP;AACH,KAJD;AAKA;AACA,QAAMmB,UAAU,SAAVA,OAAU,CAAUP,GAAV,EAAeL,IAAf,EAAqBQ,EAArB,EAAyB;AACrCd,qBAAaD,cAAb,IAA+Be,EAA/B;AACAE,eAAOL,GAAP,EAAYL,IAAZ;AACH,KAHD;AAIA;AACAV,SAAKuB,KAAL,GAAa,UAAUb,IAAV,EAAgBQ,EAAhB,EAAoB;AAC7BI,gBAAQ,OAAR,EAAiBZ,IAAjB,EAAuBQ,EAAvB;AACH,KAFD;AAGA;AACAlB,SAAKwB,gBAAL,GAAwB,UAAUd,IAAV,EAAgBQ,EAAhB,EAAoB;AACxCI,gBAAQ,kBAAR,EAA4BZ,IAA5B,EAAkCQ,EAAlC;AACH,KAFD;AAGA;AACAlB,SAAKyB,WAAL,GAAmB,UAAUP,EAAV,EAAc;AAC7BhB,eAAOO,EAAP,CAAU,WAAV,EAAuBS,EAAvB;AACH,KAFD;;AAIA,WAAOlB,IAAP;AACH,CAtDD;kBAuDeD","file":"socketController.js","sourceRoot":"../../../../../assets/Script/util","sourcesContent":["import EventListener from './eventListener'\n\nconst socketController = function () {\n    let that = {};\n    let _socket = null;\n    let _event = EventListener({});\n    let _callbackIndex = 1;\n    let _callbackMap = {};\n\n    that.init = function () {\n        _socket = io(defines.serverUrl);\n        _socket.on('welcome', function (data) {\n            console.log('welcome msg : ' + data.data);\n        });\n        _socket.on('notify', function (data) {\n            console.log(' get server notify : ' + JSON.stringify(data));\n            let msg = data.msg;\n            _event.fire(msg, data.data);\n            let callbackIndex = data.callbackIndex;\n            if(callbackIndex){\n                let cb = _callbackMap[callbackIndex];\n                if(cb){\n                   if(data.data.err){\n                       cb(data.data.err);\n                   } else {\n                       cb(null, data.data);\n                   }\n                }\n            }\n        });\n    };\n    // 无回掉消息\n    const notify = function (msg, data) {\n        console.log(' notify to server msg = ' + msg + ', callbackIndex =  ' + _callbackIndex + ' , data =  ' + JSON.stringify(data));\n        _socket.emit('notify', {msg: msg, callbackIndex: _callbackIndex, data: data});\n        _callbackIndex++;\n    };\n    // 发送消息，等待回掉\n    const request = function (msg, data, cb) {\n        _callbackMap[_callbackIndex] = cb;\n        notify(msg, data);\n    };\n    // 登陆\n    that.login = function (data, cb) {\n        request('login', data, cb);\n    };\n    // 注册并登陆\n    that.registerAndLogin = function (data, cb) {\n        request('registerAndLogin', data, cb);\n    };\n    // 进入游戏\n    that.onEnterGame = function (cb) {\n        _event.on('enterGame', cb);\n    };\n\n    return that;\n};\nexport default socketController;"]}